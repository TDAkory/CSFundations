# Rate Limiter

## 限流算法

|算法|描述|关键参数|优点|缺点|
|-------------|-------------|-------------|-------------|-------------|
|令牌桶 Token Bucket|按照一定速率向桶中添加令牌，桶装满则多余的令牌丢弃，请求需消耗令牌。|桶大小和填充速率|可以应对一定程度的流量突增|在流量变化时，如何权衡桶大小和填充率|
|漏桶 Leaking Bucket|请求填充到桶里，桶满了则拒绝请求。桶里的元素以固定的速率流出|桶大小和消费速率|使用丢列易实现|消费速率固定，存在效率问题 |
|固定窗口计数 Fixed Window Counter| 时间维度划分窗口，每个窗口允许通过固定数量的请求，超出则会拒绝。||简单易于理解|时间窗口边缘应对流量高峰时，可能会让通过的请求数超过设置的阈值|
|滑动窗口日志 Sliding Window Log|每个请求记录请求时间，过期删除日志。请求通过时需要判断集合内的日志数不超过阈值||限速准确|额外内存开销 |
|活动窗口计数 Sliding Window Counter|在固定窗口的基础上拆分更小的子窗口，每次滑动一个子窗口的范围||避免超出限制||

## 分布式场景

上述算法在单节点下很好实现，其中令牌桶和滑动窗口是两种较好的选择，能够一定程度上处理不均匀的请求分布。但在分布式场景下，仅考虑算法是不够的。

算法配置位置：

1. 配置在负载均衡器
   1. 这个方式的限流是全局性的。但是涉及到对负载均衡器进行修改，可能破坏“职责单一”，缺少”容错能力“，功能耦合导致”不方便扩容“

2. 配置在中心化数据库
   1. 服务流量不大的情况下，这种简单的方式是可行的
   2. 服务流量上涨之后，每个请求都需要请求数据库并等待数据库的响应，导致数据库压力增大，处理延迟增加

3. 优化介于中心化数据库的限流器
   1. 分布式限流：减少访问中心的频率，在分布式节点上做一部分限流器的工作，再周期性地访问数据库同步
   2. Option-1 

## Ref

- [设计一个限流组件](https://www.cnblogs.com/myshowtime/p/16313623.html)